<ion-header>
  <app-main-header
    [nombre]="user?.nombre + ' ' + user?.apellido"
    [avatar]="user?.foto || 'assets/img/foto.png'"
    (logout)="logout()"
  ></app-main-header>
</ion-header>

<ion-content class="simple-welcome">
  <!-- Header del perfil minimalista -->
  <div class="profile-section" *ngIf="user">
    <div class="profile-avatar">
      <img [src]="user?.foto || 'assets/img/user.svg'" alt="Avatar" class="avatar-image">
    </div>
    <div class="profile-info">
      <!-- <h2 class="title">Usuario:</h2> -->
      <h1 class="user-name">Hola, {{ user.nombre_completo }} </h1>
      <p class="user-email">Correo: {{ user.correo }}</p>
      <p class="user-phone">Cedula: {{ user.cedula  }}</p>
      <p class="user-phone">Celular: {{ user.celular || 'No disponible' }}</p>
      <p class="user-location">Municipio: {{ user.municipio || 'Municipio ID: ' + user.municipio_id }}</p>
      <p class="user-phone">Registrado por: {{ createdByName }}</p>
      <p class="user-role">Rol: {{ user.rol }}</p>
      <p class="user-role">Permisos:</p>
       <ion-chip *ngFor="let permiso of getPermissionsList()" color="success">
          <ion-icon name="checkmark-circle" class="check-icon"></ion-icon>
          <ion-label>{{ permiso }}</ion-label>
        </ion-chip>



    </div>
  </div>

  <!-- Cards de métricas simplificadas -->
  <div class="metrics-container">
    <!-- Card de Votantes -->
    <div class="metric-card votantes-card">
      <div class="metric-header">
        <span class="metric-title">Votantes Registrados</span>
      </div>
      <div class="metric-value">{{ user?.registers || 0 }}</div>
    </div>

    <!-- Card de Calificación -->
    <div class="metric-card rating-card">
      <div class="metric-header">
        <span class="metric-title">Calificación</span>
      </div>
      <div class="rating-display">
        <div class="rating-stars">
          <ion-icon
          *ngFor="let star of [1,2,3,4,5]; let i = index"
          [name]="i < getStarCount() ? 'star' : 'star-outline'"
          [class]="i < getStarCount() ? 'star-filled' : 'star-empty'">
        </ion-icon>
      </div>
      <!-- <div class="rating-number">{{ user?.rating || 0 }}</div> -->
      </div>
    </div>
  </div>




  <!-- Acciones rápidas simplificadas -->
  <div class="quick-actions" *ngIf="hasAnyActions()">
    <!-- Botón para registrar usuarios (solo si tiene permisos) -->
    <button
      *ngIf="user?.permisos?.puede_registrar_usuarios"
      (click)="openRegisterModal()"
      class="action-button register-btn">
      <ion-icon name="person-add" class="action-icon"></ion-icon>
      <span>Registrar Usuario</span>
    </button>

    <!-- Botón para evaluar líder (solo para usuarios registrados por otros usuarios) -->
    <button
      *ngIf="user?.created_by && createdByName !== 'Sistema'"
      (click)="openEvaluateModal()"
      class="action-button evaluate-btn">
      <ion-icon name="star" class="action-icon"></ion-icon>
      <span>Evaluar a {{ createdByName }}</span>
    </button>
  </div>
</ion-content>
